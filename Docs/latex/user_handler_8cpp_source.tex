\hypertarget{user_handler_8cpp_source}{}\doxysection{user\+Handler.\+cpp}
\label{user_handler_8cpp_source}\index{hackableEspDevice/userHandler.cpp@{hackableEspDevice/userHandler.cpp}}
\mbox{\hyperlink{user_handler_8cpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00001}00001 \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00002}00002 \textcolor{comment}{ * File:      UserHandler.cpp}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00003}00003 \textcolor{comment}{ * Author:    Luke de Munk \& Twenne Elffers}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00004}00004 \textcolor{comment}{ * Class:     UserHandler}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00005}00005 \textcolor{comment}{ * Version:   0.1}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00006}00006 \textcolor{comment}{ * }}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00007}00007 \textcolor{comment}{ * Class for the http authentication process.}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00008}00008 \textcolor{comment}{ */}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00009}00009 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{user_handler_8h}{UserHandler.h}}"{}}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00010}00010 }
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00011}00011 \textcolor{comment}{/**************************************************************************/}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00016}00016 \textcolor{comment}{/**************************************************************************/}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00017}\mbox{\hyperlink{class_user_handler_ae44272296983fa6a2df985c8e2596109}{00017}} \mbox{\hyperlink{class_user_handler_ae44272296983fa6a2df985c8e2596109}{UserHandler::UserHandler}}(ESP8266WebServer *\mbox{\hyperlink{hackable_esp_device_8ino_aa72803246b81e36ff710193eefb8ef69}{server}}) \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00018}00018     \_numberUsers = 0;}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00019}00019 \}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00020}00020 }
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00021}00021 \textcolor{comment}{/**************************************************************************/}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00025}00025 \textcolor{comment}{/**************************************************************************/}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00026}\mbox{\hyperlink{class_user_handler_ab5267a38ddc76c3887e535fd02914370}{00026}} \textcolor{keywordtype}{void} \mbox{\hyperlink{class_user_handler_ab5267a38ddc76c3887e535fd02914370}{UserHandler::updateUsers}}() \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00027}00027     \textcolor{comment}{/* If there is no file, return 0 users */}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00028}00028     \textcolor{keywordflow}{if} (!SPIFFS.exists(\mbox{\hyperlink{config2_8h_a0f35d3b3a0b89c7b2b3285936c4d41a7}{HTTP\_CONFIG\_LOCATION}})) \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00029}00029         \_numberUsers = 0;}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00030}00030         \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00031}00031     \}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00032}00032 }
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00033}00033     File configFile = SPIFFS.open(\mbox{\hyperlink{config2_8h_a0f35d3b3a0b89c7b2b3285936c4d41a7}{HTTP\_CONFIG\_LOCATION}}, \textcolor{stringliteral}{"{}r"{}});}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00034}00034     String line;}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00035}00035     String* user;}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00037}00037     \textcolor{comment}{/* Extract user information line by line */}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00038}00038     \textcolor{keywordflow}{for}(uint8\_t i = 0; i < \mbox{\hyperlink{config2_8h_aa5df64e0df4fb1fd5822282ff1972e74}{MAX\_NUMBER\_USERS}}*\mbox{\hyperlink{config2_8h_a422d4595c282537965ffb1db954d2046}{USER\_INFO\_LENGTH}}; i+=\mbox{\hyperlink{config2_8h_a422d4595c282537965ffb1db954d2046}{USER\_INFO\_LENGTH}}) \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00039}00039         line = configFile.readStringUntil(\textcolor{charliteral}{'\(\backslash\)n'});                            \textcolor{comment}{//Read a line from the file}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00040}00040         \textcolor{keywordflow}{if} (line != \textcolor{stringliteral}{"{}"{}} \&\& line.indexOf(\textcolor{stringliteral}{"{}:"{}}) != -\/1) \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00041}00041             user = \_parseLine(line);}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00042}00042             \_users[i] = user[0].c\_str();}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00043}00043             \_users[i+1] = user[1].c\_str();}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00044}00044             \_users[i+2] = user[2].c\_str();}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00045}00045         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00046}00046             \_numberUsers = i-\/1;}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00047}00047             \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00048}00048         \}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00049}00049         \_numberUsers = i-\/1;}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00050}00050     \}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00051}00051     configFile.close();}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00052}00052 \}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00053}00053 }
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00054}00054 \textcolor{comment}{/**************************************************************************/}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00058}00058 \textcolor{comment}{/**************************************************************************/}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00059}\mbox{\hyperlink{class_user_handler_af30dbda21be1f07ba95a3a2040b0bed6}{00059}} String* \mbox{\hyperlink{class_user_handler_af30dbda21be1f07ba95a3a2040b0bed6}{UserHandler::getUsers}}() \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00060}00060     \textcolor{keywordflow}{return} \_users;}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00061}00061 \}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00062}00062 }
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00063}00063 \textcolor{comment}{/**************************************************************************/}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00067}00067 \textcolor{comment}{/**************************************************************************/}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00068}\mbox{\hyperlink{class_user_handler_abc8548e9a986b34e225c0a127dd4fbfb}{00068}} uint8\_t \mbox{\hyperlink{class_user_handler_abc8548e9a986b34e225c0a127dd4fbfb}{UserHandler::getNumberOfUsers}}() \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00069}00069     \textcolor{keywordflow}{return} \_numberUsers;}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00070}00070 \}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00071}00071 }
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00072}00072 \textcolor{comment}{/**************************************************************************/}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00079}00079 \textcolor{comment}{/**************************************************************************/}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00080}\mbox{\hyperlink{class_user_handler_a4f44b5bbcb227ad8f3d4c0857f0d715a}{00080}} \textcolor{keywordtype}{bool} \mbox{\hyperlink{class_user_handler_a4f44b5bbcb227ad8f3d4c0857f0d715a}{UserHandler::checkPermission}}(uint8\_t permissionLevel, ESP8266WebServer *\mbox{\hyperlink{hackable_esp_device_8ino_aa72803246b81e36ff710193eefb8ef69}{server}}) \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00081}00081     \textcolor{keywordtype}{bool} isLoggedIn = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00082}00082     \textcolor{keywordtype}{bool} hasPermission = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00083}00083     uint8\_t userIndex = 0;}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00084}00084     }
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00085}00085     \textcolor{keywordflow}{if} (permissionLevel == \mbox{\hyperlink{config2_8h_a824e9b77b01c21dc817aa156bc98f319}{PERMISSION\_LVL\_ALL}}) \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00086}00086         \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00087}00087     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00088}00088         \textcolor{keywordflow}{for} (uint8\_t i = 0; i < \_numberUsers; i += 3) \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00089}00089             \textcolor{keywordflow}{if} (\mbox{\hyperlink{hackable_esp_device_8ino_aa72803246b81e36ff710193eefb8ef69}{server}}-\/>authenticate(\_users[i].c\_str(), \_users[i+1].c\_str())) \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00090}00090                 userIndex = i;}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00091}00091                 isLoggedIn = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00092}00092                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00093}00093             \}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00094}00094         \}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00095}00095 }
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00096}00096         \textcolor{keywordflow}{if} (isLoggedIn \&\& atoi(\_users[userIndex+2].c\_str()) >= permissionLevel) \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00097}00097             \textcolor{keywordflow}{return} \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00098}00098         \}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00099}00099     \}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00100}00100     \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00101}00101 \}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00102}00102 }
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00103}00103 \textcolor{comment}{/**************************************************************************/}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00109}00109 \textcolor{comment}{/**************************************************************************/}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00110}00110 String* UserHandler::\_parseLine(String line) \{}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00111}00111   \textcolor{keyword}{static} String userInfo[3];}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00112}00112 }
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00113}00113   uint8\_t indexForUsername = line.indexOf(\textcolor{stringliteral}{"{}:"{}});                             \textcolor{comment}{//gets loc of first "{}:"{}}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00114}00114   uint8\_t indexForPassword = line.indexOf(\textcolor{stringliteral}{"{}:"{}}, indexForUsername+1);         \textcolor{comment}{//gets loc of second "{}:"{}}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00115}00115 }
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00116}00116   userInfo[0] = line.substring(0, indexForUsername);                        \textcolor{comment}{//Selects xxxx from xxxx:yyyy:zzzz, username}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00117}00117   userInfo[1] = line.substring(indexForUsername+1, indexForPassword);       \textcolor{comment}{//Selects yyyy from xxxx:yyyy:zzzz, password}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00118}00118   userInfo[2] = line.substring(indexForPassword+1);                         \textcolor{comment}{//Selects zzzz from xxxx:yyyy:zzzz, usertype}}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00119}00119   \textcolor{keywordflow}{return} userInfo;}
\DoxyCodeLine{\Hypertarget{user_handler_8cpp_source_l00120}00120 \}}

\end{DoxyCode}
